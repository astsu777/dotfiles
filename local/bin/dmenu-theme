#!/usr/bin/env bash
#===================================================
# Author: Gaetan (gaetan@ictpourtous.com)
# Creation: Sun Aug 2021 15:54:18
# Last modified: Sun Aug 2021 16:12:40
# Version: 1.0
#
# Description: Toggle graphical themes
#===================================================

#=======================
# Functions
#=======================
notify() {
	notify-send "🖌️ Theme Installed" "Please reload your WM to apply new theme (or reboot)"
	echo "Theme Installed. Please reload your WM to apply new theme (or reboot)"
}

#=======================
# Custom Theme
#=======================
toggleCustom() {
	# VIM
	if type vim > /dev/null 2>&1 && [[ -f "$HOME"/.vimrc ]]; then
    	sed -i --follow-symlinks '/^colorscheme/c colorscheme kuroi' "$HOME"/.vimrc 2>&1
    	sed -i --follow-symlinks "/^let g:lightline = {'colorscheme'/c let g:lightline = {'colorscheme': 'jellybeans'}" "$HOME"/.vimrc 2>&1
	fi
	# Alacritty
	if type alacritty > /dev/null 2>&1 && [[ -f "$HOME"/.config/alacritty/alacritty.yml ]]; then
		sed -i --follow-symlinks '/^\ \ -\ ~\/\.config\/alacritty\/.*_theme\.yml/c \ \ -\ \~\/\.config\/alacritty\/custom_theme\.yml' "$HOME"/.config/alacritty/alacritty.yml 2>&1
	fi
	# ST
	if type st > /dev/null 2>&1 && [[ -f /opt/st/config.h ]]; then
    	sudo sed -i '/^\/\* normal black \*\//c\/\* normal black \*\/\ \ \ \ \ \ \ \ "#333333",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal red \*\//c\/\* normal red \*\/\ \ \ \ \ \ \ \ "#cc6666",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal green \*\//c\/\* normal green \*\/\ \ \ \ \ \ \ \ "#81bd68",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal yellow \*\//c\/\* normal yellow \*\/\ \ \ \ \ \ \ \ "#f0c674",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal blue \*\//c\/\* normal blue \*\/\ \ \ \ \ \ \ \ "#6699ff",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal magenta \*\//c\/\* normal magenta \*\/\ \ \ \ \ \ \ \ "#b294bb",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal cyan \*\//c\/\* normal cyan \*\/\ \ \ \ \ \ \ \ "#789bba",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal white \*\//c\/\* normal white \*\/\ \ \ \ \ \ \ \ "#c5c6c8",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright black \*\//c\/\* bright black \*\/\ \ \ \ \ \ \ \ "#595959",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright red \*\//c\/\* bright red \*\/\ \ \ \ \ \ \ \ "#d98c8c",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright green \*\//c\/\* bright green \*\/\ \ \ \ \ \ \ \ "#a7d095",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright yellow \*\//c\/\* bright yellow \*\/\ \ \ \ \ \ \ \ "#f5daa3",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright blue \*\//c\/\* bright blue \*\/\ \ \ \ \ \ \ \ "#9ab4cb",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright magenta \*\//c\/\* bright magenta \*\/\ \ \ \ \ \ \ \ "#c7b1cd",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright cyan \*\//c\/\* bright cyan \*\/\ \ \ \ \ \ \ \ "#add2dc",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright white \*\//c\/\* bright white \*\/\ \ \ \ \ \ \ \ "#e5e6e5",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* foreground \*\//c\/\* foreground \*\/\ \ \ \ \ \ \ \ "#c5c8c6",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* background \*\//c\/\* background \*\/\ \ \ \ \ \ \ \ "#1c1c1c",' /opt/st/config.h 2>&1
    	sudo make -C /opt/st clean install > /dev/null 2>&1
	fi
	# XTerm
	if type xterm > /dev/null 2>&1; then
		if [[ -f "$HOME"/.config/X11/Xresources ]]; then
			XRESOURCES="$HOME/.config/X11/Xresources"
		elif [[ -f "$HOME"/.Xresources ]]; then
			XRESOURCES="$HOME/.Xresources"
		fi
    	sed -i --follow-symlinks '/^\*\.foreground:/c \*\.foreground:\ \ \ #c5c8c6' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.background:/c \*\.background:\ \ \ #1c1c1c' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.cursorColor:/c \*\.cursorColor:\ \ #c5c8c6' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color0:/c \*\.color0:\ \ \ \ \ \ \ #333333' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color8:/c \*\.color8:\ \ \ \ \ \ \ #595959' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color1:/c \*\.color1:\ \ \ \ \ \ \ #cc6666' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color9:/c \*\.color9:\ \ \ \ \ \ \ #d98c8c' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color2:/c \*\.color2:\ \ \ \ \ \ \ #81bd68' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color10:/c \*\.color10:\ \ \ \ \ \ #a7d095' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color3:/c \*\.color3:\ \ \ \ \ \ \ #f0c674' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color11:/c \*\.color11:\ \ \ \ \ \ #f5daa3' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color4:/c \*\.color4:\ \ \ \ \ \ \ #6699ff' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color12:/c \*\.color12:\ \ \ \ \ \ #9ab4cb' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color5:/c \*\.color5:\ \ \ \ \ \ \ #b294bb' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color13:/c \*\.color13:\ \ \ \ \ \ #c7b1cd' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color6:/c \*\.color6:\ \ \ \ \ \ \ #789bba' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color14:/c \*\.color14:\ \ \ \ \ \ #add2cd' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color7:/c \*\.color7:\ \ \ \ \ \ \ #c5c8c6' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color15:/c \*\.color15:\ \ \ \ \ \ #e5e6e5' "$XRESOURCES" 2>&1
    	xrdb -merge -I$HOME "$XRESOURCES" > /dev/null 2>&1
	fi
	# BSPWM
	if type bspwm > /dev/null 2>&1 && [[ -f "$HOME"/.config/bspwm/bspwmrc ]]; then
    	sed -i --follow-symlinks '/^bspc config active_border_color/c bspc config active_border_color \\#282c34' "$HOME"/.config/bspwm/bspwmrc 2>&1
    	sed -i --follow-symlinks '/^bspc config normal_border_color/c bspc config normal_border_color \\#282c34' "$HOME"/.config/bspwm/bspwmrc 2>&1
    	sed -i --follow-symlinks '/^bspc config focused_border_color/c bspc config focused_border_color \\#304569' "$HOME"/.config/bspwm/bspwmrc 2>&1
		if [[ -f "$HOME"/.config/bspwm/polybar.config ]]; then
    		sed -i --follow-symlinks '/^background = #/c background = #282c34' "$HOME"/.config/bspwm/polybar.config 2>&1
    		sed -i --follow-symlinks '/^foreground = #/c foreground = #d7d7d7' "$HOME"/.config/bspwm/polybar.config 2>&1
    		sed -i --follow-symlinks '/^primary = #/c primary = #5e81ec' "$HOME"/.config/bspwm/polybar.config 2>&1
		fi
	fi
	# DWM
	if type dwm > /dev/null 2>&1 && [[ -f /opt/dwm/config.h ]]; then
    	sudo sed -i '/^static const char col_gray1\[\]/c static const char col_gray1\[\]\ \ \ \ \ \ \ = "#282c34";' /opt/dwm/config.h 2>&1
    	sudo sed -i '/^static const char col_gray2\[\]/c static const char col_gray2\[\]\ \ \ \ \ \ \ = "#282c34";' /opt/dwm/config.h 2>&1
    	sudo sed -i '/^static const char col_gray3\[\]/c static const char col_gray3\[\]\ \ \ \ \ \ \ = "#d7d7d7";' /opt/dwm/config.h 2>&1
    	sudo sed -i '/^static const char col_gray4\[\]/c static const char col_gray4\[\]\ \ \ \ \ \ \ = "#d7d7d7";' /opt/dwm/config.h 2>&1
    	sudo sed -i '/^static const char col_cyan\[\]/c static const char col_cyan\[\]\ \ \ \ \ \ \ = "#304569";' /opt/dwm/config.h 2>&1
    	sudo sed -i '/^static const char col_border\[\]/c static const char col_border\[\]\ \ \ \ \ \ \ = "#304569";' /opt/dwm/config.h 2>&1
    	sudo make -C /opt/dwm clean install > /dev/null 2>&1
	fi
	notify
}

#=======================
# Gruvbox Theme
#=======================
toggleGruvbox() {
	# VIM
	if type vim > /dev/null 2>&1 && [[ -f "$HOME"/.vimrc ]]; then
    	sed -i --follow-symlinks '/^colorscheme /c colorscheme gruvbox-material' "$HOME"/.vimrc 2>&1
    	sed -i --follow-symlinks "/^let g:lightline = {'colorscheme'/c let g:lightline = {'colorscheme': 'gruvbox_material'}" "$HOME"/.vimrc 2>&1
    	if ! grep "^\s*Plug 'sainnhe/gruvbox-material'" "$HOME"/.vimrc > /dev/null 2>&1; then
        	sed -i --follow-symlinks "/^call plug#begin/a \ \ \ \ \"\" Colorscheme" "$HOME"/.vimrc 2>&1
        	sed -i --follow-symlinks "/\"\" Colorscheme/a \ \ \ \ Plug 'sainnhe\/gruvbox-material'" "$HOME"/.vimrc 2>&1
    	fi
	fi
	# Alacritty
	if type alacritty > /dev/null 2>&1 && [[ -f "$HOME"/.config/alacritty/alacritty.yml ]]; then
		sed -i --follow-symlinks '/^\ \ -\ ~\/\.config\/alacritty\/.*_theme\.yml/c \ \ -\ \~\/\.config\/alacritty\/gruvbox_theme\.yml' "$HOME"/.config/alacritty/alacritty.yml 2>&1
	fi
	# ST
	if type st > /dev/null 2>&1 && [[ -f /opt/st/config.h ]]; then
    	sudo sed -i '/^\/\* normal black \*\//c\/\* normal black \*\/\ \ \ \ \ \ \ \ "#282828",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal red \*\//c\/\* normal red \*\/\ \ \ \ \ \ \ \ "#cc241d",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal green \*\//c\/\* normal green \*\/\ \ \ \ \ \ \ \ "#98971a",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal yellow \*\//c\/\* normal yellow \*\/\ \ \ \ \ \ \ \ "#d79921",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal blue \*\//c\/\* normal blue \*\/\ \ \ \ \ \ \ \ "#458588",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal magenta \*\//c\/\* normal magenta \*\/\ \ \ \ \ \ \ \ "#b16286",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal cyan \*\//c\/\* normal cyan \*\/\ \ \ \ \ \ \ \ "#689d6a",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* normal white \*\//c\/\* normal white \*\/\ \ \ \ \ \ \ \ "#a89984",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright black \*\//c\/\* bright black \*\/\ \ \ \ \ \ \ \ "#928374",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright red \*\//c\/\* bright red \*\/\ \ \ \ \ \ \ \ "#fb4934",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright green \*\//c\/\* bright green \*\/\ \ \ \ \ \ \ \ "#b8bb26",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright yellow \*\//c\/\* bright yellow \*\/\ \ \ \ \ \ \ \ "#fabd2f",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright blue \*\//c\/\* bright blue \*\/\ \ \ \ \ \ \ \ "#83a598",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright magenta \*\//c\/\* bright magenta \*\/\ \ \ \ \ \ \ \ "#d3869b",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright cyan \*\//c\/\* bright cyan \*\/\ \ \ \ \ \ \ \ "#8ec07c",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* bright white \*\//c\/\* bright white \*\/\ \ \ \ \ \ \ \ "#ebdbb2",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* foreground \*\//c\/\* foreground \*\/\ \ \ \ \ \ \ \ "#ebdbb2",' /opt/st/config.h 2>&1
    	sudo sed -i '/^\/\* background \*\//c\/\* background \*\/\ \ \ \ \ \ \ \ "#282828",' /opt/st/config.h 2>&1
    	sudo make -C /opt/st clean install > /dev/null 2>&1
	fi
	# XTerm
	if type xterm > /dev/null 2>&1; then
		if [[ -f "$HOME"/.config/X11/Xresources ]]; then
			XRESOURCES="$HOME/.config/X11/Xresources"
		elif [[ -f "$HOME"/.Xresources ]]; then
			XRESOURCES="$HOME/.Xresources"
		fi
    	sed -i --follow-symlinks '/^\*\.foreground:/c \*\.foreground:\ \ \ #ebdbb2' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.background:/c \*\.background:\ \ \ #282828' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.cursorColor:/c \*\.cursorColor:\ \ #ebdbb2' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color0:/c \*\.color0:\ \ \ \ \ \ \ #282828' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color8:/c \*\.color8:\ \ \ \ \ \ \ #928374' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color1:/c \*\.color1:\ \ \ \ \ \ \ #cc241d' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color9:/c \*\.color9:\ \ \ \ \ \ \ #fb4934' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color2:/c \*\.color2:\ \ \ \ \ \ \ #98971a' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color10:/c \*\.color10:\ \ \ \ \ \ #b8bb26' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color3:/c \*\.color3:\ \ \ \ \ \ \ #d79921' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color11:/c \*\.color11:\ \ \ \ \ \ #fabd2f' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color4:/c \*\.color4:\ \ \ \ \ \ \ #458588' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color12:/c \*\.color12:\ \ \ \ \ \ #83a598' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color5:/c \*\.color5:\ \ \ \ \ \ \ #b16286' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color13:/c \*\.color13:\ \ \ \ \ \ #d3869b' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color6:/c \*\.color6:\ \ \ \ \ \ \ #689d6a' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color14:/c \*\.color14:\ \ \ \ \ \ #8ec07c' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color7:/c \*\.color7:\ \ \ \ \ \ \ #a89984' "$XRESOURCES" 2>&1
    	sed -i --follow-symlinks '/^\*\.color15:/c \*\.color15:\ \ \ \ \ \ #ebdbb2' "$XRESOURCES" 2>&1
    	xrdb -merge -I$HOME "$XRESOURCES" > /dev/null 2>&1
	fi
	# BSPWM
	if type bspwm > /dev/null 2>&1 && [[ -f "$HOME"/.config/bspwm/bspwmrc ]]; then
    	sed -i --follow-symlinks '/^bspc config active_border_color/c bspc config active_border_color \\#282828' "$HOME"/.config/bspwm/bspwmrc 2>&1
    	sed -i --follow-symlinks '/^bspc config normal_border_color/c bspc config normal_border_color \\#282828' "$HOME"/.config/bspwm/bspwmrc 2>&1
    	sed -i --follow-symlinks '/^bspc config focused_border_color/c bspc config focused_border_color \\#79520e' "$HOME"/.config/bspwm/bspwmrc 2>&1
		if [[ -f "$HOME"/.config/bspwm/polybar.config ]]; then
    		sed -i --follow-symlinks '/^background = #/c background = #282828' "$HOME"/.config/bspwm/polybar.config 2>&1
    		sed -i --follow-symlinks '/^foreground = #/c foreground = #acacac' "$HOME"/.config/bspwm/polybar.config 2>&1
    		sed -i --follow-symlinks '/^primary = #/c primary = #c98918' "$HOME"/.config/bspwm/polybar.config 2>&1
		fi
	fi
	# DWM
	if type dwm > /dev/null 2>&1 && [[ -f /opt/dwm/config.h ]]; then
    	sudo sed -i '/^static const char col_gray1\[\]/c static const char col_gray1\[\]\ \ \ \ \ \ \ = "#282828";' /opt/dwm/config.h 2>&1
    	sudo sed -i '/^static const char col_gray2\[\]/c static const char col_gray2\[\]\ \ \ \ \ \ \ = "#282828";' /opt/dwm/config.h 2>&1
    	sudo sed -i '/^static const char col_gray3\[\]/c static const char col_gray3\[\]\ \ \ \ \ \ \ = "#acacac";' /opt/dwm/config.h 2>&1
    	sudo sed -i '/^static const char col_gray4\[\]/c static const char col_gray4\[\]\ \ \ \ \ \ \ = "#282828";' /opt/dwm/config.h 2>&1
    	sudo sed -i '/^static const char col_cyan\[\]/c static const char col_cyan\[\]\ \ \ \ \ \ \ = "#c98918";' /opt/dwm/config.h 2>&1
    	sudo sed -i '/^static const char col_border\[\]/c static const char col_border\[\]\ \ \ \ \ \ \ = "#79520e";' /opt/dwm/config.h 2>&1
    	sudo make -C /opt/dwm clean install > /dev/null 2>&1
	fi
	notify
}

#=======================
# Themes List
#=======================
case "$(printf "Custom\\nGruvbox" | sort | dmenu -l 2 -i -p "Choose a theme:")" in
	"Custom") toggleCustom ;;
	"Gruvbox") toggleGruvbox ;;
	*) exit 0 ;;
esac