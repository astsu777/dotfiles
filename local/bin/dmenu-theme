#!/usr/bin/env bash
#===================================================
# Author: Gaetan (gaetan@ictpourtous.com)
# Creation: Sun Aug 2021 15:54:18
# Last modified: Sun Aug 2021 16:12:40
# Version: 1.0
#
# Description: Toggle graphical themes
#===================================================

#=======================
# Functions
#=======================
notify() {
	notify-send "🖌️ Theme Installed" "Please reload your WM to apply new theme (or reboot)"
	echo "Theme Installed. Please reload your WM to apply new theme (or reboot)"
}

#=======================
# Custom Theme
#=======================
toggleCustom() {
	# ST/Xresources
	foreground="#c5c8c6"
	background="#1c1c1c"
	normalBlack="#333333"
	normalRed="#cc6666"
	normalGreen="#81bd68"
	normalYellow="#f0c674"
	normalBlue="#6699ff"
	normalMagenta="#b294bb"
	normalCyan="#789bba"
	normalWhite="#c5c8c6"
	brightBlack="#595959"
	brightRed="#d98c8c"
	brightGreen="#a7d095"
	brightYellow="#f5daa3"
	brightBlue="#9ab4cb"
	brightMagenta="#c7b1cd"
	brightCyan="#add2cd"
	brightWhite="#e5e6e5"

	# Alacritty
	alacrittyTheme="custom_theme"

	# Kitty
	kittyTheme="custom_theme"

	# VIM
	vimColorscheme="kuroi"
	vimLightline="jellybeans"

	# BSPWM
	BSPWMBackground="#282c34"
	BSPWMForeground="#d7d7d7"
	BSPWMBar="#5e81ec"
	BSPWMActiveBorder="#304569"
	BSPWMNormalBorder="#282c34"

	# DWM
	DWMBackground="#282c34"
	DWMForeground="#d7d7d7"
	DWMBarFG="#d7d7d7"
	DWMBarBG="#304569"
	DWMNormalBorder="#282c34"
	DWMActiveBorder="#304569"

	# i3
	I3Background="#282c34"
	I3Foreground="#d7d7d7"
	I3Bar="#5e81ec"
	I3ActiveBorder="#304569"
	I3NormalBorder="#282c34"
	I3Indicator="#96abcf"
}

#=======================
# Gruvbox Theme
#=======================
toggleGruvbox() {
	# ST/Xresources
	foreground="#ebdbb2"
	background="#282828"
	normalBlack="#282828"
	normalRed="#cc241d"
	normalGreen="#98971a"
	normalYellow="#d79921"
	normalBlue="#458588"
	normalMagenta="#b16286"
	normalCyan="#689d6a"
	normalWhite="#a89984"
	brightBlack="#928374"
	brightRed="#fb4934"
	brightGreen="#b8bb26"
	brightYellow="#fabd2f"
	brightBlue="#83a598"
	brightMagenta="#d3869b"
	brightCyan="#8ec07c"
	brightWhite="#ebdbb2"

	# Alacritty
	alacrittyTheme="gruvbox_theme"

	# Kitty
	kittyTheme="gruvbox_theme"

	# VIM
	vimColorscheme="gruvbox-material"
	vimLightline="gruvbox_material"

	# BSPWM
	BSPWMBackground="#282828"
	BSPWMForeground="#acacac"
	BSPWMBar="#c98918"
	BSPWMActiveBorder="#79520e"
	BSPWMNormalBorder="#282828"

	# DWM
	DWMBackground="#282828"
	DWMForeground="#acacac"
	DWMBarFG="#282828"
	DWMBarBG="#c98918"
	DWMNormalBorder="#282828"
	DWMActiveBorder="#79520e"

	# i3
	I3Background="#282828"
	I3Foreground="#acacac"
	I3Bar="#c98918"
	I3ActiveBorder="#79520e"
	I3NormalBorder="#282828"
	I3Indicator="#e7a432"
}

#=======================
# Themes List
#=======================
case "$(printf "Custom\\nGruvbox" | sort | dmenu -l 2 -i -p "Choose a theme:")" in
	"Custom") toggleCustom ;;
	"Gruvbox") toggleGruvbox ;;
	*) exit 0 ;;
esac

#=======================
# Change theme
#=======================
# VIM
if type vim > /dev/null 2>&1 && [[ -f "$HOME"/.vimrc ]]; then
    sed -i --follow-symlinks "/^colorscheme/c colorscheme $vimColorscheme" "$HOME"/.vimrc 2>&1
    sed -i --follow-symlinks "/^let g:lightline = {'colorscheme'/c let g:lightline = {'colorscheme': '"$vimLightline"'}" "$HOME"/.vimrc 2>&1
fi

# Alacritty
if type alacritty > /dev/null 2>&1 && [[ -f "$HOME"/.config/alacritty/alacritty.yml ]]; then
	sed -i --follow-symlinks "/^\ \ -\ ~\/\.config\/alacritty\/.*_theme\.yml/c \ \ -\ \~\/\.config\/alacritty\/$alacrittyTheme\.yml" "$HOME"/.config/alacritty/alacritty.yml 2>&1
fi

# Kitty
if type kitty > /dev/null 2>&1 && [[ -f "$HOME"/.config/kitty/kitty.conf ]]; then
	sed -i --follow-symlinks "/^include\s.*_theme\.conf/c include $kittyTheme\.conf" "$HOME"/.config/kitty/kitty.conf 2>&1
fi

# ST
if type st > /dev/null 2>&1 && [[ -f /opt/st/config.h ]]; then
    sudo sed -i "/^\/\* normal black \*\//c\/\* normal black \*\/\ \ \ \ \ \ \ \ \"$normalBlack\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* normal red \*\//c\/\* normal red \*\/\ \ \ \ \ \ \ \ \"$normalRed\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* normal green \*\//c\/\* normal green \*\/\ \ \ \ \ \ \ \ \"$normalGreen\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* normal yellow \*\//c\/\* normal yellow \*\/\ \ \ \ \ \ \ \ \"$normalYellow\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* normal blue \*\//c\/\* normal blue \*\/\ \ \ \ \ \ \ \ \"$normalBlue\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* normal magenta \*\//c\/\* normal magenta \*\/\ \ \ \ \ \ \ \ \"$normalMagenta\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* normal cyan \*\//c\/\* normal cyan \*\/\ \ \ \ \ \ \ \ \"$normalCyan\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* normal white \*\//c\/\* normal white \*\/\ \ \ \ \ \ \ \ \"$normalWhite\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* bright black \*\//c\/\* bright black \*\/\ \ \ \ \ \ \ \ \"$brightBlack\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* bright red \*\//c\/\* bright red \*\/\ \ \ \ \ \ \ \ \"$brightRed\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* bright green \*\//c\/\* bright green \*\/\ \ \ \ \ \ \ \ \"$brightGreen\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* bright yellow \*\//c\/\* bright yellow \*\/\ \ \ \ \ \ \ \ \"$brightYellow\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* bright blue \*\//c\/\* bright blue \*\/\ \ \ \ \ \ \ \ \"$brightBlue\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* bright magenta \*\//c\/\* bright magenta \*\/\ \ \ \ \ \ \ \ \"$brightMagenta\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* bright cyan \*\//c\/\* bright cyan \*\/\ \ \ \ \ \ \ \ \"$brightCyan\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* bright white \*\//c\/\* bright white \*\/\ \ \ \ \ \ \ \ \"$brightWhite\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* foreground \*\//c\/\* foreground \*\/\ \ \ \ \ \ \ \ \"$foreground\"," /opt/st/config.h 2>&1
    sudo sed -i "/^\/\* background \*\//c\/\* background \*\/\ \ \ \ \ \ \ \ \"$background\"," /opt/st/config.h 2>&1
    sudo make -C /opt/st clean install > /dev/null 2>&1
fi

# XTerm
if type xterm > /dev/null 2>&1; then
	if [[ -f "$HOME"/.config/X11/Xresources ]]; then
		XRESOURCES="$HOME/.config/X11/Xresources"
	elif [[ -f "$HOME"/.Xresources ]]; then
		XRESOURCES="$HOME/.Xresources"
	fi
    sed -i --follow-symlinks "/^\*\.foreground:/c \*\.foreground:\ \ \ $foreground" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.background:/c \*\.background:\ \ \ $background" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.cursorColor:/c \*\.cursorColor:\ \ $foreground" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color0:/c \*\.color0:\ \ \ \ \ \ \ $normalBlack" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color8:/c \*\.color8:\ \ \ \ \ \ \ $brightBlack" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color1:/c \*\.color1:\ \ \ \ \ \ \ $normalRed" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color9:/c \*\.color9:\ \ \ \ \ \ \ $brightRed" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color2:/c \*\.color2:\ \ \ \ \ \ \ $normalGreen" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color10:/c \*\.color10:\ \ \ \ \ \ $brightGreen" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color3:/c \*\.color3:\ \ \ \ \ \ \ $normalYellow" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color11:/c \*\.color11:\ \ \ \ \ \ $brightYellow" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color4:/c \*\.color4:\ \ \ \ \ \ \ $normalBlue" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color12:/c \*\.color12:\ \ \ \ \ \ $brightBlue" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color5:/c \*\.color5:\ \ \ \ \ \ \ $normalMagenta" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color13:/c \*\.color13:\ \ \ \ \ \ $brightMagenta" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color6:/c \*\.color6:\ \ \ \ \ \ \ $normalCyan" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color14:/c \*\.color14:\ \ \ \ \ \ $brightCyan" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color7:/c \*\.color7:\ \ \ \ \ \ \ $normalWhite" "$XRESOURCES" 2>&1
    sed -i --follow-symlinks "/^\*\.color15:/c \*\.color15:\ \ \ \ \ \ $brightWhite" "$XRESOURCES" 2>&1
    xrdb -merge -I$HOME "$XRESOURCES" > /dev/null 2>&1
fi

# BSPWM
if type bspwm > /dev/null 2>&1 && [[ -f "$HOME"/.config/bspwm/bspwmrc ]]; then
    sed -i --follow-symlinks "/^bspc config active_border_color/c bspc config active_border_color \\$BSPWMNormalBorder" "$HOME"/.config/bspwm/bspwmrc 2>&1
    sed -i --follow-symlinks "/^bspc config normal_border_color/c bspc config normal_border_color \\$BSPWMNormalBorder" "$HOME"/.config/bspwm/bspwmrc 2>&1
    sed -i --follow-symlinks "/^bspc config focused_border_color/c bspc config focused_border_color \\$BSPWMActiveBorder" "$HOME"/.config/bspwm/bspwmrc 2>&1
	if [[ -f "$HOME"/.config/bspwm/polybar.config ]]; then
    	sed -i --follow-symlinks "/^background = #/c background = $BSPWMBackground" "$HOME"/.config/bspwm/polybar.config 2>&1
    	sed -i --follow-symlinks "/^foreground = #/c foreground = $BSPWMForeground" "$HOME"/.config/bspwm/polybar.config 2>&1
    	sed -i --follow-symlinks "/^primary = #/c primary = $BSPWMBar" "$HOME"/.config/bspwm/polybar.config 2>&1
	fi
	if [[ -f "$HOME"/.config/bspwm/polybar-txt.config ]]; then
    	sed -i --follow-symlinks "/^background = #/c background = $BSPWMBackground" "$HOME"/.config/bspwm/polybar-txt.config 2>&1
    	sed -i --follow-symlinks "/^foreground = #/c foreground = $BSPWMForeground" "$HOME"/.config/bspwm/polybar-txt.config 2>&1
    	sed -i --follow-symlinks "/^primary = #/c primary = $BSPWMBar" "$HOME"/.config/bspwm/polybar-txt.config 2>&1
	fi
fi

# DWM
if type dwm > /dev/null 2>&1 && [[ -f /opt/dwm/config.h ]]; then
    sudo sed -i "/^static const char col_gray1\[\]/c static const char col_gray1\[\]\ \ \ \ \ \ \ = \"$DWMBackground\";" /opt/dwm/config.h 2>&1
    sudo sed -i "/^static const char col_gray2\[\]/c static const char col_gray2\[\]\ \ \ \ \ \ \ = \"$DWMNormalBorder\";" /opt/dwm/config.h 2>&1
    sudo sed -i "/^static const char col_gray3\[\]/c static const char col_gray3\[\]\ \ \ \ \ \ \ = \"$DWMForeground\";" /opt/dwm/config.h 2>&1
    sudo sed -i "/^static const char col_gray4\[\]/c static const char col_gray4\[\]\ \ \ \ \ \ \ = \"$DWMBarFG\";" /opt/dwm/config.h 2>&1
    sudo sed -i "/^static const char col_cyan\[\]/c static const char col_cyan\[\]\ \ \ \ \ \ \ = \"$DWMBarBG\";" /opt/dwm/config.h 2>&1
    sudo sed -i "/^static const char col_border\[\]/c static const char col_border\[\]\ \ \ \ \ \ \ = \"$DWMActiveBorder\";" /opt/dwm/config.h 2>&1
    sudo make -C /opt/dwm clean install > /dev/null 2>&1
fi

# i3
if type dwm > /dev/null 2>&1 && [[ -f "$HOME"/.config/i3/config ]]; then
    sed -i --follow-symlinks "/^client\.focused\s.*/c client\.focused \ \ \ \ \ \ \ \ \ $I3ActiveBorder $I3ActiveBorder $I3ActiveBorder $I3Indicator \ \ $I3ActiveBorder" "$HOME"/.dotfiles/config/i3/config 2>&1
    sed -i --follow-symlinks "/^client\.focused_inactive\s.*/c client\.focused_inactive $I3NormalBorder $I3NormalBorder $I3NormalBorder $I3NormalBorder \ \ $I3NormalBorder" "$HOME"/.dotfiles/config/i3/config 2>&1
    sed -i --follow-symlinks "/^client\.unfocused\s.*/c client\.unfocused \ \ \ \ \ \ \ $I3NormalBorder $I3NormalBorder $I3NormalBorder $I3NormalBorder \ \ $I3NormalBorder" "$HOME"/.dotfiles/config/i3/config 2>&1
	if [[ -f "$HOME"/.config/i3/polybar.config ]]; then
    	sed -i --follow-symlinks "/^background = #/c background = $I3Background" "$HOME"/.config/i3/polybar.config 2>&1
    	sed -i --follow-symlinks "/^foreground = #/c foreground = $I3Foreground" "$HOME"/.config/i3/polybar.config 2>&1
    	sed -i --follow-symlinks "/^primary = #/c primary = $I3Bar" "$HOME"/.config/i3/polybar.config 2>&1
	fi
	if [[ -f "$HOME"/.config/i3/polybar-txt.config ]]; then
    	sed -i --follow-symlinks "/^background = #/c background = $I3Background" "$HOME"/.config/i3/polybar-txt.config 2>&1
    	sed -i --follow-symlinks "/^foreground = #/c foreground = $I3Foreground" "$HOME"/.config/i3/polybar-txt.config 2>&1
    	sed -i --follow-symlinks "/^primary = #/c primary = $I3Bar" "$HOME"/.config/i3/polybar-txt.config 2>&1
	fi
fi

notify