#!/usr/bin/env sh
#=========================================================================
# Author: Gaetan (gaetan@ictpourtous.com) - Twitter: @GaetanICT
# Creation: Mon 24 Apr 2023 16:41:25
# Last modified: Mon 24 Apr 2023 16:54:25
# Version: 1.0
#
# Description: monitors desktop notifications and log them to a file
#=========================================================================

#=======================
# VARIABLES
#=======================

# Log file location as an argument
logfile=$1

#=======================
# MONITOR NOTIFICATIONS
#=======================

dbus-monitor "interface='org.freedesktop.Notifications'" |\
grep --line-buffered "string" |\
grep --line-buffered -e method -e ":" -e '""' -e urgency -e notify -v |\
grep --line-buffered '.*(?=string)|(?<=string).*' -oPi |\
grep --line-buffered -v '^\s*$' |\
xargs -I '{}' \

# Output format
printf '%s\n' "$(date +"[%Y-%m-%d - %H:%M:%S]")"{}"\n" >> "$logfile"

